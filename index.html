<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Baddiez</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" />
  <style>
    /* Reset and Base Styles */
    :root {
      --primary: #00b7ff;
      --accent: #ffd700;
      --background: #1a1a2e;
      --surface: #2a2a3e;
      --text: #e0e0e0;
      --text-secondary: #a0a0b0;
      --error: #ff4d4d;
      --success: #4caf50;
      --shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      --radius: 0.75rem;
      --video-width: min(100vw, 480px);
      --video-aspect: calc(16 / 9);
    }

    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--background);
      color: var(--text);
      line-height: 1.5;
      min-height: 100vh;
      overflow-x: hidden;
      scroll-behavior: smooth;
    }

    /* Header */
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 64px;
      background: var(--surface);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1rem;
      z-index: 1000;
      box-shadow: var(--shadow);
    }

    .logo {
      width: 40px;
      height: 40px;
      object-fit: contain;
    }

    .app-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text);
    }

    .menu-btn {
      background: none;
      border: none;
      color: var(--primary);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: background 0.2s;
    }

    .menu-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    /* Sidebar */
    #sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: min(80vw, 280px);
      height: 100vh;
      background: var(--surface);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      z-index: 1001;
      display: flex;
      flex-direction: column;
      padding: 1rem;
    }

    #sidebar.open {
      transform: translateX(0);
    }

    .sidebar-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1.5rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-logo {
      width: 64px;
      height: 64px;
      margin-bottom: 0.5rem;
    }

    .sidebar-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text);
    }

    .sidebar-links {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      padding: 1rem 0;
    }

    .sidebar-links button,
    .sidebar-links a {
      padding: 0.75rem 1rem;
      background: none;
      border: none;
      color: var(--text);
      text-align: left;
      font-size: 1rem;
      cursor: pointer;
      border-radius: var(--radius);
      transition: background 0.2s, color 0.2s;
      text-decoration: none;
    }

    .sidebar-links button:hover,
    .sidebar-links a:hover {
      background: var(--primary);
      color: #fff;
    }

    #overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }

    #overlay.active {
      display: block;
    }

    /* Content */
    .content {
      padding: 80px 0 72px;
      max-width: var(--video-width);
      margin: 0 auto;
      min-height: 100vh;
    }

    .page {
      display: none;
      padding: 1rem;
    }

    .page.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Home Page */
    .home-page {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      min-height: calc(100vh - 152px);
    }

    .home-hero {
      width: 100%;
      max-height: 50vh;
      object-fit: cover;
      border-radius: var(--radius);
      margin-bottom: 1rem;
    }

    .home-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 0.5rem;
    }

    .home-text {
      font-size: 1rem;
      color: var(--text-secondary);
    }

    /* Videos Page */
    #videos {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .video-card {
      width: 100%;
      aspect-ratio: var(--video-aspect);
      background: #000;
      border-radius: var(--radius);
      overflow: hidden;
      position: relative;
      box-shadow: var(--shadow);
    }

    .video-card video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .resolution-selector {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(0, 0, 0, 0.7);
      color: var(--text);
      border: none;
      border-radius: 0.25rem;
      padding: 0.25rem 0.5rem;
      font-size: 0.875rem;
      cursor: pointer;
    }

    /* Premium Page */
    #premium-video {
      width: 100%;
      aspect-ratio: var(--video-aspect);
      background: #000;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    #premium-video video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Info Page */
    .info-page {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      text-align: center;
    }

    .info-logo {
      width: 96px;
      height: 96px;
      margin: 0 auto;
    }

    .info-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--accent);
    }

    .info-blink {
      font-size: 2rem;
      color: var(--success);
      animation: blink 2s ease-in-out infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }

    .info-btn {
      background: var(--accent);
      color: #1a1a1a;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
      max-width: 200px;
      margin: 0 auto;
    }

    .info-btn:hover {
      background: #ffea00;
    }

    .info-text {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    /* Privacy Page */
    .privacy-page {
      text-align: center;
    }

    .privacy-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 0.5rem;
    }

    .privacy-toggle {
      background: var(--surface);
      color: var(--text);
      border: none;
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      font-size: 1rem;
      cursor: pointer;
      margin: 1rem 0;
    }

    .privacy-content {
      display: none;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .privacy-content.active {
      display: block;
    }

    /* Popups */
    .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 2000;
    }

    .popup-overlay.active {
      display: block;
    }

    .popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--surface);
      border-radius: var(--radius);
      padding: 1.5rem;
      max-width: min(90vw, 400px);
      z-index: 2001;
      color: var(--text);
      display: none;
    }

    .popup.active {
      display: block;
    }

    .popup-close {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: none;
      border: none;
      color: var(--accent);
      font-size: 1.25rem;
      cursor: pointer;
    }

    .popup-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 1rem;
    }

    .popup-content {
      font-size: 0.875rem;
    }

    /* Auth Popup */
    .auth-popup {
      display: none;
      justify-content: center;
      align-items: center;
    }

    .auth-popup.active {
      display: flex;
    }

    .auth-popup form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      background: var(--surface);
      padding: 1.5rem;
      border-radius: var(--radius);
      max-width: min(90vw, 320px);
    }

    .auth-popup input {
      padding: 0.5rem;
      border: 1px solid var(--text-secondary);
      border-radius: 0.25rem;
      background: var(--background);
      color: var(--text);
      font-size: 0.875rem;
    }

    .auth-popup button {
      background: var(--accent);
      color: #1a1a1a;
      border: none;
      padding: 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
    }

    .auth-popup button:hover {
      background: #ffea00;
    }

    .auth-error {
      color: var(--error);
      font-size: 0.75rem;
      text-align: center;
    }

    /* Error Popup */
    #error-popup {
      background: var(--error);
      color: #fff;
      padding: 1rem;
      max-width: min(90vw, 300px);
      text-align: center;
    }

    /* Loading */
    #loading {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 3000;
      color: var(--text);
      font-size: 1rem;
      background: var(--surface);
      padding: 1rem;
      border-radius: var(--radius);
    }

    #loading.active {
      display: block;
    }

    /* Bottom Navigation */
    nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 64px;
      background: var(--surface);
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 1000;
      box-shadow: var(--shadow);
    }

    .nav-btn {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 0.75rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
      cursor: pointer;
      padding: 0.5rem;
      transition: color 0.2s, background 0.2s;
    }

    .nav-btn img {
      width: 24px;
      height: 24px;
      filter: brightness(0.8);
    }

    .nav-btn.active,
    .nav-btn:hover {
      color: var(--primary);
      background: rgba(0, 183, 255, 0.1);
    }

    .nav-btn.active img,
    .nav-btn:hover img {
      filter: brightness(1) hue-rotate(180deg);
    }

    /* Responsive Design */
    @media (min-width: 768px) {
      .content {
        max-width: 720px;
      }

      .home-hero {
        max-height: 400px;
      }

      .home-title {
        font-size: 2rem;
      }

      #sidebar {
        width: 320px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <img src="assets/images/logo.png" class="logo" alt="Baddiez Logo" />
    <span class="app-title">Baddiez</span>
    <button class="menu-btn" id="menu-btn" aria-label="Open menu">☰</button>
  </header>

  <!-- Sidebar -->
  <div id="overlay"></div>
  <aside id="sidebar">
    <div class="sidebar-header">
      <img src="assets/images/logo.png" class="sidebar-logo" alt="Baddiez Logo" />
      <h2 class="sidebar-title">Baddiez</h2>
      <small style="color: var(--text-secondary);">© 2025 - T&C Apply</small>
    </div>
    <nav class="sidebar-links">
      <button data-page="info">Info</button>
      <a href="https://wa.me/254720047018" target="_blank">Payment</a>
      <button data-page="privacy">Privacy Policy</button>
    </nav>
  </aside>

  <!-- Content -->
  <main class="content">
    <!-- Home Page -->
    <section class="page home-page active" id="home-page">
      <img src="assets/images/home image.jpg" class="home-hero" alt="Hero Image" />
      <h1 class="home-title">Welcome to Baddiez</h1>
      <p class="home-text">Discover exclusive videos and premium content. Subscribe now for an ad-free experience!</p>
    </section>

    <!-- Previews Page -->
    <section class="page" id="previews-page">
      <div id="videos"></div>
    </section>

    <!-- Premium Page -->
    <section class="page" id="premium-page">
      <div id="premium-video"></div>
    </section>

    <!-- Info Page -->
    <section class="page" id="info-page">
      <img src="assets/images/logo.png" class="info-logo" alt="Baddiez Logo" />
      <h2 class="info-title">Unlock Premium</h2>
      <p class="info-blink">Pay via Mpesa</p>
      <p><strong>Till No: 123456 | Ksh 99 | 1 Month</strong></p>
      <button class="info-btn" id="subscribe-btn">Subscribe Now</button>
      <h3 class="info-title">Premium Benefits</h3>
      <p class="info-text">
        <strong>Exclusive Videos:</strong> Access unique content.<br>
        <strong>Early Access:</strong> Watch new videos first.<br>
        <strong>Full Length:</strong> Uncut, ad-free videos.<br>
        <strong>HD/4K:</strong> High-quality streaming.<br>
        <strong>Ad-Free:</strong> Uninterrupted viewing.<br>
        <strong>Priority Support:</strong> Fast assistance.<br>
        <small>© 2025 Baddiez. All rights reserved.</small>
      </p>
      <img src="assets/images/logo2.png" style="width: 64px; margin: 1rem auto;" alt="Secondary Logo" />
    </section>

    <!-- Privacy Page -->
    <section class="page" id="privacy-page">
      <h2 class="privacy-title">Privacy Policy</h2>
      <p style="color: var(--text-secondary);">Effective: Jan 1, 2025</p>
      <button class="privacy-toggle" id="privacy-toggle">Show Details</button>
      <div class="privacy-content" id="privacy-content">
        <p><strong>1. Introduction</strong><br>We value your privacy and protect your data.</p>
        <p><strong>2. Information Collected</strong><br>Only voluntary data (e.g., payment details).</p>
        <p><strong>3. Use of Data</strong><br>Used for payments and premium access.</p>
        <p><strong>4. Security</strong><br>Secure payment processing via Mpesa.</p>
        <p><strong>5. Sharing</strong><br>We do not share your data.</p>
        <p><strong>6. Cookies</strong><br>No cookies or tracking used.</p>
        <p><strong>7. Updates</strong><br>Policy updates posted here.</p>
        <p><strong>8. Contact</strong><br>Reach us via Telegram.</p>
        <p style="color: var(--accent);">Thank you for trusting Baddiez!</p>
        <small>© 2025 Baddiez. All rights reserved.</small>
      </div>
    </section>
  </main>

  <!-- Popups -->
  <div class="popup-overlay" id="subscribe-overlay"></div>
  <div class="popup" id="subscribe-popup">
    <button class="popup-close" id="subscribe-close">×</button>
    <h3 class="popup-title">How to Subscribe</h3>
    <div class="popup-content">
      <ol>
        <li>Pay via Mpesa (Till No: 123456, Ksh 99).</li>
        <li>Go to Menu > Payment.</li>
        <li>Send Mpesa transaction code via WhatsApp.</li>
        <li>Receive access instructions.</li>
        <li>Sign in on Premium tab.</li>
      </ol>
    </div>
  </div>

  <div class="popup-overlay auth-popup" id="auth-overlay"></div>
  <div class="popup auth-popup" id="auth-popup">
    <form id="auth-form">
      <h3 class="popup-title">Sign In</h3>
      <input type="email" id="auth-email" placeholder="Email" required />
      <input type="password" id="auth-password" placeholder="Password" required />
      <button type="submit">Sign In / Sign Up</button>
      <p class="auth-error" id="auth-error"></p>
    </form>
  </div>

  <div class="popup" id="error-popup">
    <p id="error-message">An error occurred.</p>
  </div>

  <div id="loading">Loading...</div>

  <!-- Navigation -->
  <nav>
    <button class="nav-btn" data-page="previews">
      <img src="assets/images/previews icon.png" alt="Previews" />
      Previews
    </button>
    <button class="nav-btn active" data-page="home">
      <img src="assets/images/home icon.png" alt="Home" />
      Home
    </button>
    <button class="nav-btn" data-page="premium">
      <img src="assets/images/premium icon.png" alt="Premium" />
      Premium
    </button>
  </nav>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const SUPABASE_URL = 'https://dvicmtexrtfbxqomndxh.supabase.co';
      const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR2aWNtdGV4cnRmYnhxb21uZHhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcwMDA0NzQsImV4cCI6MjA2MjU3NjQ3NH0.CqTnwcXARVLJsQkELi_xh2XaJ7ixMVjHk7ZZc5LhUrU';
      const supabase = window.supabase?.createClient(SUPABASE_URL, SUPABASE_KEY);
      if (!supabase) {
        showError('Supabase initialization failed.');
        return;
      }

      // DOM Elements
      const elements = {
        menuBtn: document.getElementById('menu-btn'),
        sidebar: document.getElementById('sidebar'),
        overlay: document.getElementById('overlay'),
        videos: document.getElementById('videos'),
        premiumVideo: document.getElementById('premium-video'),
        subscribeBtn: document.getElementById('subscribe-btn'),
        subscribePopup: document.getElementById('subscribe-popup'),
        subscribeOverlay: document.getElementById('subscribe-overlay'),
        subscribeClose: document.getElementById('subscribe-close'),
        authPopup: document.getElementById('auth-popup'),
        authOverlay: document.getElementById('auth-overlay'),
        authForm: document.getElementById('auth-form'),
        authEmail: document.getElementById('auth-email'),
        authPassword: document.getElementById('auth-password'),
        authError: document.getElementById('auth-error'),
        errorPopup: document.getElementById('error-popup'),
        errorMessage: document.getElementById('error-message'),
        loading: document.getElementById('loading'),
        privacyToggle: document.getElementById('privacy-toggle'),
        privacyContent: document.getElementById('privacy-content'),
        pages: document.querySelectorAll('.page'),
        navBtns: document.querySelectorAll('.nav-btn'),
        sidebarLinks: document.querySelectorAll('.sidebar-links button')
      };

      let currentPage = 'home';
      let observer = null;

      // Utilities
      function showLoading() {
        elements.loading.classList.add('active');
      }

      function hideLoading() {
        elements.loading.classList.remove('active');
      }

      function showError(message, duration = 5000) {
        elements.errorMessage.textContent = message;
        elements.errorPopup.classList.add('active');
        setTimeout(() => elements.errorPopup.classList.remove('active'), duration);
      }

      function closePopups() {
        elements.sidebar.classList.remove('open');
        elements.overlay.classList.remove('active');
        elements.subscribePopup.classList.remove('active');
        elements.subscribeOverlay.classList.remove('active');
        elements.authPopup.classList.remove('active');
        elements.authOverlay.classList.remove('active');
        elements.pages.forEach(page => page.classList.remove('blur'));
      }

      function showPage(pageId) {
        closePopups();
        elements.pages.forEach(page => page.classList.toggle('active', page.id === `${pageId}-page`));
        elements.navBtns.forEach(btn => btn.classList.toggle('active', btn.dataset.page === pageId));
        currentPage = pageId;
        if (pageId === 'previews') loadPreviews();
        if (pageId === 'premium') loadPremium();
      }

      // Video Loading
      async function loadPreviews() {
        showLoading();
        elements.videos.innerHTML = '';
        try {
          const { data: files, error } = await supabase.storage.from('previews').list('', { limit: 10 });
          if (error) throw new Error(`Failed to fetch previews: ${error.message}`);

          const videoFiles = files.filter(file => /\.(mp4|webm)$/i.test(file.name));
          if (!videoFiles.length) {
            elements.videos.innerHTML = '<p style="text-align: center;">No preview videos available.</p>';
            return;
          }

          for (const file of videoFiles) {
            const { data, error } = await supabase.storage.from('previews').createSignedUrl(file.name, 3600);
            if (error) {
              console.warn(`Signed URL error for ${file.name}:`, error);
              continue;
            }

            const videoUrl = data.signedUrl || 'https://www.w3schools.com/html/mov_bbb.mp4';
            const card = document.createElement('div');
            card.className = 'video-card';
            const video = document.createElement('video');
            video.src = videoUrl;
            video.muted = true;
            video.playsinline = true;
            video.controls = true;
            video.dataset.lowSrc = videoUrl;
            video.dataset.highSrc = videoUrl;

            const select = document.createElement('select');
            select.className = 'resolution-selector';
            select.innerHTML = '<option value="low">Low</option><option value="high">High</option>';
            select.addEventListener('change', () => {
              const currentTime = video.currentTime;
              const isPlaying = !video.paused;
              video.src = select.value === 'low' ? video.dataset.lowSrc : video.dataset.highSrc;
              video.currentTime = currentTime;
              if (isPlaying) video.play().catch(err => console.warn('Play failed:', err));
            });

            card.append(video, select);
            elements.videos.appendChild(card);
          }

          if (observer) observer.disconnect();
          observer = new IntersectionObserver(
            entries => {
              entries.forEach(entry => {
                const video = entry.target.querySelector('video');
                if (entry.isIntersecting) {
                  gsap.fromTo(entry.target, { opacity: 0, scale: 0.9 }, { opacity: 1, scale: 1, duration: 0.5 });
                  video.play().catch(() => {
                    video.controls = true;
                  });
                } else {
                  gsap.to(entry.target, { opacity: 0, scale: 0.9, duration: 0.5 });
                  video.pause();
                  video.currentTime = 0;
                }
              });
            },
            { threshold: 0.5 }
          );

          document.querySelectorAll('.video-card').forEach(card => observer.observe(card));
        } catch (err) {
          showError(`Error loading previews: ${err.message}`);
          elements.videos.innerHTML = '<p style="text-align: center;">Failed to load previews.</p>';
        } finally {
          hideLoading();
        }
      }

      async function loadPremium() {
        showLoading();
        elements.premiumVideo.innerHTML = '';
        try {
          const { data: files, error } = await supabase.storage.from('premium').list('', { limit: 1 });
          if (error) throw new Error(`Failed to fetch premium video: ${error.message}`);

          if (!files.length) {
            elements.premiumVideo.innerHTML = '<p style="text-align: center;">No premium videos available.</p>';
            return;
          }

          const file = files[0];
          if (!/\.(mp4|webm)$/i.test(file.name)) {
            elements.premiumVideo.innerHTML = '<p style="text-align: center;">No valid premium videos.</p>';
            return;
          }

          const { data, error: signedError } = await supabase.storage.from('premium').createSignedUrl(file.name, 3600);
          if (signedError) throw new Error(`Signed URL error: ${signedError.message}`);

          const videoUrl = data.signedUrl || 'https://www.w3schools.com/html/mov_bbb.mp4';
          const video = document.createElement('video');
          video.src = videoUrl;
          video.muted = true;
          video.playsinline = true;
          video.controls = true;
          video.dataset.lowSrc = videoUrl;
          video.dataset.highSrc = videoUrl;

          const select = document.createElement('select');
          select.className = 'resolution-selector';
          select.innerHTML = '<option value="low">Low</option><option value="high">High</option>';
          select.addEventListener('change', () => {
            const currentTime = video.currentTime;
            const isPlaying = !video.paused;
            video.src = select.value === 'low' ? video.dataset.lowSrc : video.dataset.highSrc;
            video.currentTime = currentTime;
            if (isPlaying) video.play().catch(err => console.warn('Play failed:', err));
          });

          elements.premiumVideo.append(video, select);
          video.play().catch(() => {
            video.controls = true;
          });

          const { data: user, error: authError } = await supabase.auth.getUser();
          if (authError || !user.user) {
            elements.authPopup.classList.add('active');
            elements.authOverlay.classList.add('active');
            document.getElementById('premium-page').classList.add('blur');
          }
        } catch (err) {
          showError(`Error loading premium video: ${err.message}`);
          elements.premiumVideo.innerHTML = '<p style="text-align: center;">Failed to load premium video.</p>';
        } finally {
          hideLoading();
        }
      }

      // Authentication
      async function handleAuth(e) {
        e.preventDefault();
        showLoading();
        const email = elements.authEmail.value.trim();
        const password = elements.authPassword.value.trim();
        if (!email || !password) {
          elements.authError.textContent = 'Email and password required.';
          hideLoading();
          return;
        }

        try {
          let { data, error } = await supabase.auth.signInWithPassword({ email, password });
          if (error && error.message.includes('Invalid login')) {
            ({ data, error } = await supabase.auth.signUp({ email, password }));
          }
          if (error) throw new Error(error.message);

          closePopups();
          window.location.href = 'https://t.me/+BzdnBVoE76EzNWZk';
        } catch (err) {
          elements.authError.textContent = err.message;
        } finally {
          hideLoading();
        }
      }

      // Event Listeners
      elements.menuBtn.addEventListener('click', () => {
        elements.sidebar.classList.toggle('open');
        elements.overlay.classList.toggle('active');
        document.getElementById(`${currentPage}-page`).classList.toggle('blur');
      });

      elements.overlay.addEventListener('click', closePopups);

      elements.navBtns.forEach(btn => {
        btn.addEventListener('click', () => showPage(btn.dataset.page));
      });

      elements.sidebarLinks.forEach(link => {
        link.addEventListener('click', () => showPage(link.dataset.page));
      });

      elements.subscribeBtn.addEventListener('click', () => {
        elements.subscribePopup.classList.add('active');
        elements.subscribeOverlay.classList.add('active');
        document.getElementById('info-page').classList.add('blur');
      });

      elements.subscribeClose.addEventListener('click', closePopups);
      elements.subscribeOverlay.addEventListener('click', e => {
        if (e.target === elements.subscribeOverlay) closePopups();
      });

      elements.authForm.addEventListener('submit', handleAuth);
      elements.authOverlay.addEventListener('click', e => {
        if (e.target === elements.authOverlay) {
          closePopups();
          showPage('previews');
        }
      });

      elements.privacyToggle.addEventListener('click', () => {
        const isOpen = elements.privacyContent.classList.toggle('active');
        elements.privacyToggle.textContent = isOpen ? 'Hide Details' : 'Show Details';
      });
    });
  </script>
</body>
</html>