<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Baddiez</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:900,700,400&display=swap" />
  <style>
    :root {
      --primary: #4fc3f7;
      --accent: #ffd700;
      --bg: #343541;
      --bar-bg: #444654;
      --shadow: 0 4px 24px rgba(0,0,0,0.18);
      --radius: 1rem;
      --icon-size: 2rem;
      --menu-width: 90vw;
      --menu-max-width: 20rem;
      --bar-float: 0.3rem;
      --medium-grey: #799dcc;
      --text-light: #d1d5db;
      --error-red: #e53935;
      --dark-bg: #23243a;
      --white: #ffffff;
      --light-green: lightgreen;
      --video-width: 360px;
      --video-height: 640px;
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Montserrat', 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background: var(--bg);
      min-height: 100vh;
      overflow-x: hidden;
    }

    body {
      padding-top: 4rem;
      padding-bottom: 4.5rem;
      position: relative;
    }

    .top-bar {
      position: fixed;
      top: var(--bar-float);
      left: 50%;
      transform: translateX(-50%);
      width: calc(100vw - 2rem);
      max-width: 30rem;
      height: 4rem;
      background: var(--bar-bg);
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 1002;
      padding: 0 1rem;
      border-radius: var(--radius);
    }

    .logo {
      height: 2.5rem;
      width: 2.5rem;
      object-fit: contain;
    }

    .app-title {
      flex: 1;
      text-align: center;
      font-weight: 580;
      color: var(--white);
      font-size: 1.5rem;
      user-select: none;
    }

    .menu-btn {
      background: none;
      border: none;
      font-size: 2rem;
      color: var(--primary);
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      transition: background 0.2s;
    }

    .menu-btn:hover, .menu-btn:focus {
      background: #f0f7fa;
      outline: none;
    }

    #popupOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.25);
      z-index: 1001;
      transition: background 0.2s;
    }

    #popupMenu {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      height: 90vh;
      width: var(--menu-width);
      max-width: var(--menu-max-width);
      background: var(--bar-bg);
      box-shadow: 2px 0 24px rgba(0,0,0,0.18);
      z-index: 1003;
      border-top-right-radius: 1.5rem;
      border-bottom-right-radius: 1.5rem;
      padding: 0;
      animation: slideInLeft 0.25s ease-out;
      display: flex;
      flex-direction: column;
    }

    @keyframes slideInLeft {
      from { transform: translateX(-100%); }
      to { transform: translateX(0); }
    }
    @-webkit-keyframes slideInLeft {
      from { -webkit-transform: translateX(-100%); }
      to { -webkit-transform: translateX(0); }
    }

    .side-popup-header {
      padding: 2rem 0 1rem;
      background: var(--bg);
      border-top-right-radius: 1.5rem;
      text-align: center;
    }

    .side-popup-logo {
      width: 4rem;
      height: 4rem;
      object-fit: contain;
      margin-bottom: 0.5rem;
    }

    .side-popup-title {
      color: var(--white);
      font-size: 1.5rem;
      font-weight: 580;
      margin-bottom: 0.5rem;
    }

    .side-popup-links {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      padding: 2rem 1.5rem;
    }

    .side-popup-links button,
    .side-popup-links a {
      padding: 0.875rem 0 0.875rem 1.125rem;
      background: var(--bg);
      color: var(--text-light);
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 0.9rem;
      font-family: inherit;
      text-decoration: none;
      transition: background 0.18s, color 0.18s;
      text-align: left;
    }

    .side-popup-links button:hover,
    .side-popup-links a:hover {
      background: var(--accent);
      color: #181c23;
    }

    .bottom-bar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100vw;
      height: 4.5rem;
      background: var(--bar-bg);
      display: flex;
      align-items: center;
      justify-content: space-around;
      z-index: 1002;
      padding-bottom: 0;
      gap: 0;
    }

    .bottom-bar .bar-btn {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: none;
      border: none;
      color: var(--white);
      font-size: 0.75rem;
      font-weight: 450;
      cursor: pointer;
      padding: 0;
      transition: color 0.2s, background 0.2s;
      border-radius: 0.625rem;
      height: 100%;
    }

    .bottom-bar .bar-btn .icon img {
      width: var(--icon-size);
      height: var(--icon-size);
      object-fit: contain;
      filter: brightness(1.2) invert(1);
      transition: filter 0.2s;
    }

    .bottom-bar .bar-btn.active,
    .bottom-bar .bar-btn:hover {
      color: var(--primary);
      background: rgba(79, 195, 247, 0.08);
    }

    .bottom-bar .bar-btn.active .icon img,
    .bottom-bar .bar-btn:hover .icon img {
      filter: brightness(1.2) invert(74%) sepia(80%) saturate(400%) hue-rotate(170deg) brightness(1.5);
    }

    main {
      margin: 0 auto;
      max-width: var(--video-width);
      min-height: calc(100vh - 8.5rem);
      padding: 0 0 1.5rem;
      background: var(--bg);
    }

    .page {
      display: none;
      width: 100%;
      min-height: 60vh;
      padding-top: 0.75rem;
    }

    .page.active {
      display: block;
      animation: fadeIn 0.3s;
    }

    .page.blur {
      filter: blur(6px);
      pointer-events: none;
      user-select: none;
      transition: filter 0.2s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .home-img-holder {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #222;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      z-index: 1;
    }

    .home-img-holder img {
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      max-width: 100vw;
      max-height: 100vh;
    }

    .info-text {
      margin: 0 auto;
      max-width: 26.25rem;
      padding: 0.75rem 0.625rem 0;
      color: var(--text-light);
      font-size: 0.9rem;
      line-height: 1.2;
      text-align: center;
      white-space: pre-line;
    }

    .info-text .logo {
      width: 8rem;
      height: 8rem;
      margin-bottom: 0.75rem;
    }

    .info-text .small-logo {
      width: 4rem;
      height: 4rem;
      margin-top: 0;
    }

    .info-text .highlight {
      color: var(--accent);
      font-weight: bold;
      font-size: 1.5rem;
      display: block;
      text-align: center;
    }

    .info-text .blink {
      color: var(--light-green);
      font-size: 2.5rem;
      animation: blink-animation 2.2s ease-in-out infinite;
      will-change: opacity;
    }

    @keyframes blink-animation {
      0% { opacity: 1; }
      45% { opacity: 1; }
      55% { opacity: 0; }
      100% { opacity: 1; }
    }
    @-webkit-keyframes blink-animation {
      0% { opacity: 1; }
      45% { opacity: 1; }
      55% { opacity: 0; }
      100% { opacity: 1; }
    }

    .info-text .subscribe-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--accent);
      color: #666;
      border: none;
      border-radius: 0.75rem;
      padding: 0.5rem 1.5rem;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 12px rgba(0,0,0,0.10);
      transition: background 0.2s;
      margin: 0.5rem auto;
      height: 2.5rem;
      min-width: 7.5rem;
    }

    .info-text .subscribe-btn:hover {
      background: #ffe066;
    }

    .privacy-text {
      margin: 0 auto;
      max-width: 26.25rem;
      padding: 0.75rem 0.625rem 0;
      color: var(--text-light);
      font-size: 0.9rem;
      line-height: 1.2;
      text-align: center;
      white-space: pre-line;
    }

    .privacy-text .dropdown-btn {
      margin: 0 auto 0.75rem;
      background: var(--bar-bg);
      color: var(--white);
      border: none;
      border-radius: 0.5rem;
      padding: 0.5rem 1.125rem;
      font-size: 1rem;
      cursor: pointer;
    }

    .privacy-text .dropdown-body {
      margin-top: 0.5rem;
      text-align: center;
    }

    #howToSubscribePopupOverlay, #authPopup {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.45);
      z-index: 2000;
    }

    #howToSubscribePopup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--dark-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 2rem 1.5rem 1.5rem;
      min-width: 16.25rem;
      max-width: 90vw;
      z-index: 2001;
      text-align: center;
      color: var(--white);
      animation: popupFadeIn 0.25s;
    }

    #authPopup {
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 4000;
    }

    #authPopup > div {
      background: var(--dark-bg);
      border-radius: var(--radius);
      padding: 2rem 1.5rem;
      max-width: 21.25rem;
      margin: auto;
      text-align: center;
    }

    #authPopup h3 {
      margin: 0 0 1.125rem;
      color: var(--accent);
      font-size: 1.2rem;
      font-weight: bold;
    }

    #authPopup input {
      width: 90%;
      padding: 0.625rem;
      border-radius: 0.5rem;
      border: 1px solid #bdbdbd;
      font-size: 1rem;
      margin-bottom: 1.125rem;
      outline: none;
      text-align: center;
    }

    #authPopup button {
      background: var(--accent);
      color: #222;
      border: none;
      border-radius: 0.5rem;
      padding: 0.625rem 1.5rem;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      min-width: 5rem;
    }

    #authPopup button:hover {
      background: #ffe066;
    }

    #authPopup .error {
      color: var(--error-red);
      margin-top: 0.5rem;
    }

    #wrongKeyPopup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--error-red);
      color: var(--white);
      border-radius: 0.875rem;
      box-shadow: 0 2px 16px rgba(0,0,0,0.14);
      padding: 2rem 2.25rem;
      z-index: 3000;
      font-size: 1.2rem;
      font-weight: bold;
      text-align: center;
      animation: popupFadeIn 0.2s;
    }

    #howToSubscribePopup .close-btn {
      position: absolute;
      top: 0.625rem;
      right: 1.125rem;
      background: none;
      border: none;
      color: var(--accent);
      font-size: 1.5rem;
      cursor: pointer;
    }

    #loading {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: var(--white);
      z-index: 5000;
      font-size: 1.2rem;
    }

    #previews-videos {
      width: var(--video-width);
      height: var(--video-height);
      margin: 0 auto;
      overflow-y: auto;
      scroll-snap-type: y mandatory;
      background: #000;
      position: relative;
    }

    .video-container {
      width: var(--video-width);
      height: var(--video-height);
      scroll-snap-align: start;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      overflow: hidden;
      transition: transform 0.5s ease-in-out;
    }

    .video-container video {
      width: 100%;
      height: 100%;
      object-fit: contain;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }

    #premium-video-holder {
      width: var(--video-width);
      height: var(--video-height);
      margin: 0 auto;
      background: #000;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    #premium-video-holder video {
      width: 100%;
      height: 100%;
      object-fit: contain;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }

    .resolution-selector {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 2;
      background: rgba(0, 0, 0, 0.7);
      color: var(--white);
      border: none;
      border-radius: 0.25rem;
      padding: 0.25rem 0.5rem;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .flip-enter {
      transform: rotateY(90deg);
      opacity: 0;
    }

    .flip-exit {
      transform: rotateY(-90deg);
      opacity: 0;
    }

    @media (max-width: 600px) {
      #popupMenu {
        width: 70vw;
        max-width: 90vw;
        border-top-right-radius: 1rem;
        border-bottom-right-radius: 1rem;
      }

      .side-popup-header {
        padding: 1.5rem 0 0.75rem;
      }

      .side-popup-links {
        padding: 1.5rem 0.75rem;
      }

      :root {
        --video-width: 100vw;
        --video-height: calc(100vw * 16 / 9);
      }
    }

    @media (min-width: 601px) {
      .top-bar {
        max-width: 37.5rem;
      }

      #popupMenu {
        width: 25vw;
        max-width: 25rem;
      }
    }
  </style>
</head>
<body>
  <!-- Top Bar -->
  <header class="top-bar">
    <img src="assets/images/logo.png" class="logo" alt="Supafutaa Logo" />
    <span class="app-title">supafutaa</span>
    <button class="menu-btn" id="menu-button" aria-label="Open menu">⋮</button>
  </header>

  <!-- Side Popup overlay and menu -->
  <div id="popupOverlay"></div>
  <aside id="popupMenu" class="side-popup-menu">
    <div class="side-popup-header">
      <img src="assets/images/logo.png" alt="Supafutaa Logo" class="side-popup-logo" />
      <div class="side-popup-title">Baddiez</div>
      <div style="color: var(--medium-grey); font-size: 0.8rem; text-align: center; margin-top: 0.25rem;">
        Copyright © 2025 - T&C Apply
      </div>
    </div>
    <nav class="side-popup-links">
      <button id="infoBtn" aria-label="View information">Info</button>
      <a href="https://wa.me/254720047018" target="_blank" id="paymentLink" aria-label="Make payment">Payment</a>
      <button id="privacyBtn" aria-label="View privacy policy">Privacy Policy</button>
    </nav>
  </aside>

  <!-- Main Content -->
  <main>
    <!-- Home Page -->
    <div class="page active" id="home-page">
      <div class="home-img-holder">
        <img src="assets/images/home image.jpg" alt="Home background" />
      </div>
    </div>
    <!-- Previews Page -->
    <div class="page" id="previews-page">
      <div id="previews-videos"></div>
    </div>
    <!-- Premium Page -->
    <div class="page" id="premium-page">
      <div id="premium-video-holder"></div>
    </div>
    <!-- Info Page -->
    <div class="page" id="info-page">
      <div class="info-text">
        <div style="display: flex; justify-content: center; align-items: center;">
          <img src="assets/images/logo.png" alt="Supafutaa Logo" class="logo" />
        </div>
        <span class="highlight">Unlock Full Premium Experience</span>
        <span class="blink">Pay via Mpesa</span>
        <span style="color: var(--white); font-weight: bold; font-size: 1.25rem; display: block; text-align: center;">
          Till No: 123456 | Amount: Kshs 99/=
        </span>
        <span style="color: var(--white); font-weight: bold; font-size: 1.25rem; display: block; text-align: center;">
          Validity: 1 month
        </span>
        <button id="howToSubscribeBtn" class="subscribe-btn" aria-label="Learn how to subscribe">Subscribe Here</button>
        <span class="highlight">Benefits of Premium Membership</span>
        <b>Exclusive Videos</b><br>
        Access 100% exclusive videos not available for free users<br><br>
        <b>Early Access</b><br>
        Watch new uploads before anyone else hours or days early.<br><br>
        <b>Full Length Content</b><br>
        Enjoy full, uncut scenes with no ads, no limits.<br><br>
        <b>High Quality Streams</b><br>
        Enjoy HD and 4K quality for the ultimate viewing experience.<br><br>
        <b>Ad-Free Experience</b><br>
        Watch without interruption, 100% ad-free viewing<br><br>
        <b>Priority Support</b><br>
        Need help? Premium subscribers get priority replies<br><br>
        <span style="color: var(--medium-grey); font-size: 0.75rem; display: block; text-align: center;">
          Copyright © Baddiez. 2025. All rights reserved
        </span>
        <div style="display: flex; justify-content: center; align-items: center;">
          <img src="assets/images/logo2.png" alt="Supafutaa Secondary Logo" class="small-logo" />
        </div>
      </div>
    </div>
    <!-- Privacy Policy Page -->
    <div class="page" id="privacy-page">
      <div class="privacy-text">
        <div style="color: var(--accent); font-weight: bold; font-size: 1.3rem;">PRIVACY POLICY</div>
        <div style="color: var(--medium-grey);">Effective date: 1st January, 2025</div>
        <br>
        <button id="privacyDropdownBtn" class="dropdown-btn" aria-label="Toggle privacy policy details">Show Details ▼</button>
        <div id="privacyDropdownBody" class="dropdown-body" style="display: none;">
          <b>1. Introduction</b><br>
          We value your privacy and are committed to protecting your personal information.<br><br>
          <b>2. Information We Collect</b><br>
          We do not collect personal information unless you provide it voluntarily (e.g., through payment or support requests).<br><br>
          <b>3. Use of Information</b><br>
          Any information you provide is used solely to process your payment and provide access to premium content.<br><br>
          <b>4. Data Security</b><br>
          We implement reasonable security measures to protect your data. Payments are processed securely via Mpesa.<br><br>
          <b>5. Sharing of Information</b><br>
          We do not sell, trade, or share your personal information with third parties.<br><br>
          <b>6. Cookies & Tracking</b><br>
          We do not use cookies or tracking technologies.<br><br>
          <b>7. Changes to This Policy</b><br>
          We may update this policy from time to time. Changes will be posted on this page.<br><br>
          <b>8. Contact Us</b><br>
          If you have any questions about this Privacy Policy, please contact us via Telegram.<br><br>
          <span style="color: var(--accent);">Thank you for trusting Baddiez!</span>
          <span style="color: var(--medium-grey); font-size: 0.75rem; display: block; text-align: center;">
            Copyright © Baddiez. 2025 All rights reserved
          </span>
        </div>
      </div>
    </div>
  </main>

  <!-- Auth Popup -->
  <div id="authPopup">
    <div>
      <h3>Sign In</h3>
      <input id="authEmail" type="email" placeholder="Email" aria-label="Email input" />
      <input id="authPassword" type="password" placeholder="Password" aria-label="Password input" />
      <button id="authSignInBtn" aria-label="Sign in or sign up">Sign In / Sign Up</button>
      <div id="authError" class="error"></div>
    </div>
  </div>

  <!-- Wrong Key Popup -->
  <div id="wrongKeyPopup" aria-live="polite">Error</div>

  <!-- How to Subscribe Popup -->
  <div id="howToSubscribePopupOverlay"></div>
  <div id="howToSubscribePopup">
    <button id="closeHowToSubscribePopup" class="close-btn" aria-label="Close subscription instructions">×</button>
    <div style="color: var(--accent); font-weight: bold; font-size: 1.2rem; text-align: center; margin-bottom: 0.75rem;">
      Steps on How To Subscribe
    </div>
    <ul style="color: var(--white); font-size: 1rem; line-height: 1.6; padding-left: 1.375rem; margin: 0;">
      <li>After payment, go to Menu and click the Payment.</li>
      <li>You will be redirected to the App WhatsApp.</li>
      <li>Paste the Mpesa transaction code & receive access instructions.</li>
      <li>Then, go to the Premium Tab and sign in to access premium content.</li>
    </ul>
  </div>

  <!-- Loading Indicator -->
  <div id="loading" aria-live="polite">Loading...</div>

  <!-- Bottom Bar -->
  <nav class="bottom-bar" id="bottomBar">
    <button class="bar-btn" id="previewsNav" aria-label="View previews">
      <span class="icon">
        <img src="assets/images/previews icon.png" alt="Previews icon" />
      </span>
      Previews
    </button>
    <button class="bar-btn active" id="homeNav" aria-label="View home">
      <span class="icon">
        <img src="assets/images/home icon.png" alt="Home icon" />
      </span>
      Home
    </button>
    <button class="bar-btn" id="premiumNav" aria-label="View premium content">
      <span class="icon">
        <img src="assets/images/premium icon.png" alt="Premium icon" />
      </span>
      Premium
    </button>
  </nav>

  <!-- External Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Supabase initialization
      const SUPABASE_URL = 'https://dvicmtexrtfbxqomndxh.supabase.co';
      const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR2aWNtdGV4cnRmYnhxb21uZHhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcwMDA0NzQsImV4cCI6MjA2MjU3NjQ3NH0.CqTnwcXARVLJsQkELi_xh2XaJ7ixMVjHk7ZZc5LhUrU';
      if (!window.supabase) {
        console.error('Supabase library not loaded.');
        document.getElementById('wrongKeyPopup').textContent = 'Failed to initialize Supabase library.';
        document.getElementById('wrongKeyPopup').style.display = 'block';
        setTimeout(() => {
          document.getElementById('wrongKeyPopup').style.display = 'none';
        }, 4000);
        return;
      }
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

      // DOM references
      const popupMenu = document.getElementById('popupMenu');
      const popupOverlay = document.getElementById('popupOverlay');
      const menuButton = document.getElementById('menu-button');
      const authPopup = document.getElementById('authPopup');
      const authSignInBtn = document.getElementById('authSignInBtn');
      const authEmail = document.getElementById('authEmail');
      const authPassword = document.getElementById('authPassword');
      const authError = document.getElementById('authError');
      const howToSubscribeBtn = document.getElementById('howToSubscribeBtn');
      const howToSubscribePopup = document.getElementById('howToSubscribePopup');
      const howToSubscribePopupOverlay = document.getElementById('howToSubscribePopupOverlay');
      const closeHowToSubscribePopup = document.getElementById('closeHowToSubscribePopup');
      const loading = document.getElementById('loading');
      const infoBtn = document.getElementById('infoBtn');
      const privacyBtn = document.getElementById('privacyBtn');
      const previewsVideos = document.getElementById('previews-videos');
      const premiumVideoHolder = document.getElementById('premium-video-holder');
      const pages = {
        home: document.getElementById('home-page'),
        previews: document.getElementById('previews-page'),
        premium: document.getElementById('premium-page'),
        info: document.getElementById('info-page'),
        privacy: document.getElementById('privacy-page')
      };
      const navBtns = {
        home: document.getElementById('homeNav'),
        previews: document.getElementById('previewsNav'),
        premium: document.getElementById('premiumNav')
      };

      let lastActivePage = 'home';
      let currentPremiumVideo = null;
      let observer = null;

      // Ensure menu is hidden on load
      popupMenu.style.display = 'none';
      popupOverlay.style.display = 'none';

      // Load preview videos from Supabase Storage
      async function loadPreviewsVideos() {
        loading.style.display = 'block';
        try {
          const { data: files, error } = await supabase.storage
            .from('previews')
            .list('', { limit: 100 });

          if (error) {
            console.error('Error fetching preview videos:', error);
            document.getElementById('wrongKeyPopup').textContent = `Failed to load previews: ${error.message || 'Unknown error'}`;
            document.getElementById('wrongKeyPopup').style.display = 'block';
            setTimeout(() => {
              document.getElementById('wrongKeyPopup').style.display = 'none';
            }, 5000);
            previewsVideos.innerHTML = '<p style="color: var(--white); text-align: center;">Unable to load preview videos.</p>';
            return;
          }

          previewsVideos.innerHTML = '';
          if (files && files.length > 0) {
            const videoFiles = files.filter(file => file.name.match(/\.(mp4|webm|ogg)$/i));
            if (videoFiles.length === 0) {
              console.warn('No video files found in previews bucket.');
              previewsVideos.innerHTML = '<p style="color: var(--white); text-align: center;">No preview videos available.</p>';
              return;
            }

            videoFiles.forEach(file => {
              const { data: publicUrlData } = supabase.storage
                .from('previews')
                .getPublicUrl(file.name);

              if (publicUrlData && publicUrlData.publicUrl) {
                const container = document.createElement('div');
                container.className = 'video-container';
                const video = document.createElement('video');
                video.src = publicUrlData.publicUrl;
                video.muted = true;
                video.playsinline = true;
                video.loop = true;
                video.controls = true;
                video.setAttribute('aria-label', 'Preview video');
                video.dataset.lowSrc = publicUrlData.publicUrl; // Default (assumed original quality)
                video.dataset.highSrc = publicUrlData.publicUrl; // Same for now, no separate 360p file

                const select = document.createElement('select');
                select.className = 'resolution-selector';
                select.innerHTML = `
                  <option value="360p">360p</option>
                  <option value="max">Max</option>
                `;
                select.addEventListener('change', () => {
                  const currentTime = video.currentTime;
                  const wasPlaying = !video.paused;
                  video.src = select.value === '360p' ? video.dataset.lowSrc : video.dataset.highSrc;
                  video.currentTime = currentTime;
                  if (wasPlaying) {
                    video.play().catch(err => console.warn('Auto-play failed:', err));
                  }
                });

                container.appendChild(video);
                container.appendChild(select);
                previewsVideos.appendChild(container);
              }
            });

            // Setup IntersectionObserver for auto-play
            if (observer) {
              observer.disconnect();
            }
            observer = new IntersectionObserver(
              (entries) => {
                entries.forEach(entry => {
                  const video = entry.target.querySelector('video');
                  if (entry.isIntersecting) {
                    gsap.fromTo(
                      entry.target,
                      { transform: 'rotateY(90deg)', opacity: 0 },
                      { transform: 'rotateY(0deg)', opacity: 1, duration: 0.5, ease: 'power2.out' }
                    );
                    video.play().catch(err => {
                      console.warn('Auto-play failed:', err);
                      video.controls = true; // Fallback to manual play
                    });
                  } else {
                    gsap.to(
                      entry.target,
                      { transform: 'rotateY(-90deg)', opacity: 0, duration: 0.5, ease: 'power2.in' }
                    );
                    video.pause();
                    video.currentTime = 0;
                  }
                });
              },
              { threshold: 0.8 }
            );

            document.querySelectorAll('.video-container').forEach(container => {
              observer.observe(container);
            });
          } else {
            console.warn('No files found in previews bucket.');
            previewsVideos.innerHTML = '<p style="color: var(--white); text-align: center;">No preview videos available.</p>';
          }
        } catch (err) {
          console.error('Unexpected error in loadPreviewsVideos:', err);
          document.getElementById('wrongKeyPopup').textContent = `Unexpected error: ${err.message || 'Unknown error'}`;
          document.getElementById('wrongKeyPopup').style.display = 'block';
          setTimeout(() => {
            document.getElementById('wrongKeyPopup').style.display = 'none';
          }, 5000);
          previewsVideos.innerHTML = '<p style="color: var(--white); text-align: center;">Unable to load preview videos.</p>';
        } finally {
          loading.style.display = 'none';
        }
      }

      // Load premium video from Supabase Storage
      async function loadPremiumVideo() {
        loading.style.display = 'block';
        try {
          const userResponse = await supabase.auth.getUser();
          if (userResponse.error || !userResponse.data.user) {
            premiumVideoHolder.innerHTML = '<p style="color: var(--white); text-align: center;">Please sign in to access premium content.</p>';
            authPopup.style.display = 'flex';
            pages.premium.classList.add('blur');
            return;
          }

          if (currentPremiumVideo) {
            currentPremiumVideo.pause();
            currentPremiumVideo.currentTime = 0;
          }

          const { data: files, error } = await supabase.storage
            .from('premium')
            .list('', { limit: 100 });

          if (error) {
            console.error('Error fetching premium videos:', error);
            premiumVideoHolder.innerHTML = `<p style="color: var(--white); text-align: center;">Failed to load premium content: ${error.message || 'Unknown error'}</p>`;
            return;
          }

          premiumVideoHolder.innerHTML = '';
          if (files && files.length > 0) {
            const videoFiles = files.filter(file => file.name.match(/\.(mp4|webm|ogg)$/i));
            if (videoFiles.length === 0) {
              console.warn('No video files found in premium bucket.');
              premiumVideoHolder.innerHTML = '<p style="color: var(--white); text-align: center;">No premium videos available.</p>';
              return;
            }

            const firstVideo = videoFiles[0];
            const { data: signedUrlData, error: signedError } = await supabase.storage
              .from('premium')
              .createSignedUrl(firstVideo.name, 3600);

            if (signedError) {
              console.error('Error creating signed URL:', signedError);
              premiumVideoHolder.innerHTML = `<p style="color: var(--white); text-align: center;">Failed to load premium video: ${signedError.message || 'Unknown error'}</p>`;
              return;
            }

            if (signedUrlData && signedUrlData.signedUrl) {
              const container = document.createElement('div');
              container.className = 'video-container';
              const video = document.createElement('video');
              video.src = signedUrlData.signedUrl;
              video.muted = true;
              video.playsinline = true;
              video.loop = true;
              video.controls = true;
              video.setAttribute('aria-label', 'Premium video');
              video.dataset.lowSrc = signedUrlData.signedUrl;
              video.dataset.highSrc = signedUrlData.signedUrl;

              const select = document.createElement('select');
              select.className = 'resolution-selector';
              select.innerHTML = `
                <option value="360p">360p</option>
                <option value="max">Max</option>
              `;
              select.addEventListener('change', () => {
                const currentTime = video.currentTime;
                const wasPlaying = !video.paused;
                video.src = select.value === '360p' ? video.dataset.lowSrc : video.dataset.highSrc;
                video.currentTime = currentTime;
                if (wasPlaying) {
                  video.play().catch(err => console.warn('Auto-play failed:', err));
                }
              });

              container.appendChild(video);
              container.appendChild(select);
              premiumVideoHolder.appendChild(container);
              currentPremiumVideo = video;

              video.play().catch(err => {
                console.warn('Auto-play failed:', err);
                video.controls = true;
              });
            } else {
              premiumVideoHolder.innerHTML = '<p style="color: var(--white); text-align: center;">Unable to load premium video.</p>';
            }
          } else {
            console.warn('No files found in premium bucket.');
            premiumVideoHolder.innerHTML = '<p style="color: var(--white); text-align: center;">No premium videos available.</p>';
          }
        } catch (err) {
          console.error('Unexpected error in loadPremiumVideo:', err);
          premiumVideoHolder.innerHTML = `<p style="color: var(--white); text-align: center;">Unexpected error: ${err.message || 'Unknown error'}</p>`;
        } finally {
          loading.style.display = 'none';
        }
      }

      // Helper to close all popups
      function closeAllPopups() {
        popupMenu.style.display = 'none';
        popupOverlay.style.display = 'none';
        authPopup.style.display = 'none';
        howToSubscribePopup.style.display = 'none';
        howToSubscribePopupOverlay.style.display = 'none';
        document.getElementById('wrongKeyPopup').style.display = 'none';
        loading.style.display = 'none';
        document.querySelectorAll('.page.blur').forEach(p => p.classList.remove('blur'));
      }

      // Show specific page
      function showPage(page) {
        closeAllPopups();
        Object.values(pages).forEach(p => p.classList.remove('active'));
        Object.values(navBtns).forEach(b => b.classList.remove('active'));
        if (pages[page]) pages[page].classList.add('active');
        if (navBtns[page]) navBtns[page].classList.add('active');
        lastActivePage = page;
      }

      // Navigation handler
      function handleNavigation(page) {
        showPage(page);
        if (page === 'previews') loadPreviewsVideos();
        if (page === 'premium') loadPremiumVideo();
      }

      // Menu toggle
      menuButton.onclick = () => {
        const isOpen = popupMenu.style.display === 'flex';
        closeAllPopups();
        if (!isOpen) {
          popupMenu.style.display = 'flex';
          popupOverlay.style.display = 'block';
          pages[lastActivePage].classList.add('blur');
        }
      };

      popupOverlay.onclick = () => closeAllPopups();

      // Navigation buttons
      navBtns.home.onclick = () => handleNavigation('home');
      navBtns.previews.onclick = () => handleNavigation('previews');
      navBtns.premium.onclick = () => handleNavigation('premium');
      infoBtn.onclick = () => handleNavigation('info');
      privacyBtn.onclick = () => handleNavigation('privacy');

      // Auth popup logic
      async function handleAuth() {
        authError.textContent = '';
        loading.style.display = 'block';
        const email = authEmail.value.trim();
        const password = authPassword.value.trim();
        if (!email || !password) {
          authError.textContent = 'Please enter email and password.';
          loading.style.display = 'none';
          return;
        }
        let { user, error } = await supabase.auth.signInWithPassword({ email, password });
        if (error && error.message.includes('Invalid login credentials')) {
          ({ user, error } = await supabase.auth.signUp({ email, password }));
        }
        loading.style.display = 'none';
        if (error) {
          authError.textContent = error.message;
          return;
        }
        authPopup.style.display = 'none';
        window.location.href = 'https://t.me/+BzdnBVoE76EzNWZk';
      }

      authSignInBtn.onclick = async () => {
        await handleAuth();
      };

      authPopup.onclick = (e) => {
        if (e.target === authPopup) {
          closeAllPopups();
          handleNavigation('previews');
        }
      };

      // How to Subscribe popup
      howToSubscribeBtn.onclick = () => {
        closeAllPopups();
        howToSubscribePopup.style.display = 'block';
        howToSubscribePopupOverlay.style.display = 'block';
        pages[lastActivePage].classList.add('blur');
      };

      closeHowToSubscribePopup.onclick = () => {
        closeAllPopups();
      };

      howToSubscribePopupOverlay.onclick = (e) => {
        if (e.target === howToSubscribePopupOverlay) {
          closeAllPopups();
        }
      };

      // Privacy dropdown
      const dropdownBtn = document.getElementById('privacyDropdownBtn');
      const dropdownBody = document.getElementById('privacyDropdownBody');
      let isDropdownOpen = false;

      dropdownBtn.addEventListener('click', () => {
        isDropdownOpen = !isDropdownOpen;
        dropdownBody.style.display = isDropdownOpen ? 'block' : 'none';
        dropdownBtn.innerHTML = isDropdownOpen ? 'Hide Details ▲' : 'Show Details ▼';
      });
    });
  </script>
</body>
</html>