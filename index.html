<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VelvetFlix - Unlock Your Secret Vibes</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@700&display=swap" />
  <style>
    /* Base Styles */
    :root {
      --background: #343541;
      --surface: #444654;
      --text: #FFFFFF;
      --text-secondary: #D1D5DB;
      --primary: #2EA4F2;
      --accent: #10A37F;
      --muted: #9CA3AF;
      --error: #EF4444;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      --radius: 0.5rem;
      --transition: 240ms ease-out;
      --video-aspect: 9 / 16;
    }

    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--background);
      color: var(--text);
      line-height: 1.5;
      min-height: 100vh;
      overflow-x: hidden;
      scroll-behavior: smooth;
    }

    /* Preloader */
    #preloader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--background);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      transition: opacity 0.5s;
    }

    #preloader.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .loader {
      border: 4px solid var(--primary);
      border-top: 4px solid var(--accent);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Header */
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(52, 53, 65, 0.9);
      backdrop-filter: blur(8px);
      padding: 0.75rem 1rem;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      width: 36px;
      height: 36px;
      object-fit: contain;
    }

    .app-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.2rem;
      color: var(--primary);
    }

    .menu-btn {
      background: none;
      border: none;
      color: var(--text);
      font-size: 1.5rem;
      cursor: pointer;
    }

    .menu {
      position: fixed;
      top: 0;
      right: -100%;
      width: 250px;
      height: 100%;
      background: var(--surface);
      padding: 2rem 1rem;
      transition: right 0.3s ease;
      z-index: 1001;
    }

    .menu.active {
      right: 0;
    }

    .menu-close {
      background: none;
      border: none;
      color: var(--primary);
      font-size: 1.5rem;
      position: absolute;
      top: 1rem;
      right: 1rem;
      cursor: pointer;
    }

    .menu ul {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 2rem;
    }

    .menu a {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 1rem;
    }

    .menu a:hover {
      color: var(--primary);
    }

    /* Content */
    .content {
      padding: 4.5rem 0 4rem;
    }

    .page {
      display: none;
      animation: fadeIn 240ms ease-out;
      padding: 1rem;
    }

    .page.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Video Feed */
    .video-feed {
      height: calc(100vh - 8.5rem);
      overflow-y: auto;
      scroll-snap-type: y mandatory;
    }

    .video-container {
      position: relative;
      width: 100%;
      height: 100%;
      scroll-snap-align: start;
      background: #000;
    }

    .video-container video {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .watermark {
      position: absolute;
      bottom: 20px;
      left: 20px;
      color: rgba(255, 255, 255, 0.5);
      font-size: 0.8rem;
      pointer-events: none;
    }

    .video-overlay {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      padding: 1rem;
      pointer-events: none;
    }

    .video-info {
      position: absolute;
      bottom: 60px;
      left: 1rem;
      background: rgba(0, 0, 0, 0.6);
      padding: 0.5rem;
      border-radius: var(--radius);
      pointer-events: auto;
      max-width: 80%;
    }

    .video-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text);
    }

    .video-actions {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      pointer-events: auto;
    }

    .action-btn {
      background: rgba(0, 0, 0, 0.6);
      border: none;
      color: var(--text);
      font-size: 1.5rem;
      cursor: pointer;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
      transition: transform var(--transition);
    }

    .action-btn:hover {
      transform: scale(1.1);
    }

    .video-loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border: 4px solid var(--primary);
      border-top: 4px solid var(--accent);
      border-radius: 50%;
      width: 36px;
      height: 36px;
      animation: spin 0.8s linear infinite;
    }

    /* Premium Page */
    .premium-page .video-feed {
      height: calc(100vh - 8.5rem);
    }

    .premium-locked {
      text-align: center;
      padding: 2rem;
      max-width: 400px;
      margin: 0 auto;
    }

    .premium-locked h2 {
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }

    .premium-locked button {
      background: var(--accent);
      color: var(--text);
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 2rem;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity var(--transition);
    }

    .premium-locked button:hover {
      opacity: 0.9;
    }

    /* Auth Page */
    .auth-page {
      max-width: 400px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }

    .auth-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      background: var(--surface);
      padding: 1.5rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .auth-form h2 {
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      color: var(--primary);
      text-align: center;
    }

    .auth-form input {
      padding: 0.75rem;
      border: 1px solid var(--muted);
      border-radius: var(--radius);
      background: var(--background);
      color: var(--text);
      font-size: 0.9rem;
    }

    .auth-form button {
      background: var(--accent);
      color: var(--text);
      border: none;
      padding: 0.75rem;
      border-radius: var(--radius);
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity var(--transition);
    }

    .auth-form button:hover {
      opacity: 0.9;
    }

    .auth-error {
      color: var(--error);
      font-size: 0.85rem;
      text-align: center;
    }

    .auth-toggle {
      text-align: center;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .auth-toggle a {
      color: var(--primary);
      text-decoration: none;
      cursor: pointer;
    }

    .auth-toggle a:hover {
      text-decoration: underline;
    }

    /* Profile Page */
    .profile-page {
      max-width: 400px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }

    .profile-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--primary);
    }

    .profile-info {
      flex: 1;
    }

    .profile-email {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text);
    }

    .profile-status {
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .profile-actions {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1rem;
    }

    .profile-btn {
      background: var(--accent);
      color: var(--text);
      border: none;
      padding: 0.75rem;
      border-radius: var(--radius);
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity var(--transition);
    }

    .profile-btn:hover {
      opacity: 0.9;
    }

    /* Admin Page */
    .admin-page {
      max-width: 400px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }

    .admin-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      background: var(--surface);
      padding: 1.5rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .admin-form h2 {
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      color: var(--primary);
      text-align: center;
    }

    .admin-form input,
    .admin-form select {
      padding: 0.75rem;
      border: 1px solid var(--muted);
      border-radius: var(--radius);
      background: var(--background);
      color: var(--text);
      font-size: 0.9rem;
    }

    .admin-form button {
      background: var(--accent);
      color: var(--text);
      border: none;
      padding: 0.75rem;
      border-radius: var(--radius);
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity var(--transition);
    }

    .admin-form button:hover {
      opacity: 0.9;
    }

    .admin-error {
      color: var(--error);
      font-size: 0.85rem;
      text-align: center;
    }

    /* Paywall Page */
    .paywall-page {
      max-width: 400px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }

    .paywall-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      background: var(--surface);
      padding: 1.5rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .paywall-form h2 {
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      color: var(--primary);
      text-align: center;
    }

    .paywall-form input {
      padding: 0.75rem;
      border: 1px solid var(--muted);
      border-radius: var(--radius);
      background: var(--background);
      color: var(--text);
      font-size: 0.9rem;
    }

    .paywall-form button {
      background: var(--accent);
      color: var(--text);
      border: none;
      padding: 0.75rem;
      border-radius: var(--radius);
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity var(--transition);
    }

    .paywall-form button:hover {
      opacity: 0.9;
    }

    .paywall-error {
      color: var(--error);
      font-size: 0.85rem;
      text-align: center;
    }

    /* Static Pages */
    .static-page {
      max-width: 600px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }

    .static-page h2 {
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }

    .static-page p {
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }

    .static-page a {
      color: var(--primary);
      text-decoration: none;
    }

    .static-page a:hover {
      text-decoration: underline;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 2000;
      display: none;
    }

    .modal-overlay.active {
      display: block;
    }

    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--surface);
      border-radius: var(--radius);
      padding: 1.5rem;
      max-width: min(90vw, 400px);
      z-index: 2001;
      color: var(--text);
      display: none;
      box-shadow: var(--shadow);
    }

    .modal.active {
      display: block;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--primary);
      font-size: 1.25rem;
      cursor: pointer;
    }

    .modal-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.25rem;
      color: var(--primary);
      margin-bottom: 1rem;
    }

    .modal-content {
      font-size: 0.9rem;
    }

    /* Toast */
    #toast {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--error);
      color: var(--text);
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius);
      z-index: 3000;
      display: none;
      font-size: 0.9rem;
      max-width: min(90vw, 360px);
      text-align: center;
    }

    #toast.active {
      display: block;
      animation: slideUp 240ms ease-out;
    }

    @keyframes slideUp {
      from { transform: translateX(-50%) translateY(20px); opacity: 0; }
      to { transform: translateX(-50%) translateY(0); opacity: 1; }
    }

    /* Bottom Navigation */
    nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: var(--surface);
      display: flex;
      justify-content: space-around;
      padding: 0.5rem 0;
      z-index: 1000;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.3);
    }

    .nav-btn {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 0.75rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
      cursor: pointer;
      padding: 0.5rem;
      transition: color var(--transition);
    }

    .nav-btn svg {
      width: 24px;
      height: 24px;
      stroke: var(--text-secondary);
    }

    .nav-btn.active,
    .nav-btn:hover {
      color: var(--primary);
    }

    .nav-btn.active svg,
    .nav-btn:hover svg {
      stroke: var(--primary);
    }

    /* Responsive Design */
    @media (min-width: 768px) {
      .content {
        padding: 5rem 2rem;
      }

      .video-feed {
        max-width: 360px;
        margin: 0 auto;
      }

      .auth-page,
      .profile-page,
      .admin-page,
      .paywall-page,
      .static-page {
        max-width: 600px;
      }
    }
  </style>
</head>
<body>
  <!-- Preloader -->
  <div id="preloader">
    <div class="loader"></div>
  </div>

  <!-- Header -->
  <header>
    <img src="assets/images/logo.png" class="logo" alt="VelvetFlix Logo" />
    <span class="app-title">VelvetFlix</span>
    <button class="menu-btn" id="menu-btn">
      <i data-lucide="menu"></i>
    </button>
  </header>

  <!-- Menu -->
  <div class="menu" id="menu">
    <button class="menu-close" id="menu-close">×</button>
    <ul>
      <li><a href="#" onClick="setPage('contact')">Contact Us</a></li>
      <li><a href="#" onClick="setPage('privacy')">Privacy Policy</a></li>
      <li><a href="#" onClick="setPage('terms')">Terms of Service</a></li>
      <li><a href="#" onClick="setPage('about')">About</a></li>
    </ul>
  </div>

  <!-- Content -->
  <div id="app"></div>

  <!-- Age Gate Modal -->
  <div class="modal-overlay" id="age-overlay"></div>
  <div class="modal" id="age-modal">
    <h3 class="modal-title">Age Verification</h3>
    <div class="modal-content">
      <p>You must be 18 or older to use VelvetFlix. Are you 18+?</p>
      <button class="profile-btn" style="width: 100%;" id="age-confirm">Yes, I am 18+</button>
    </div>
  </div>

  <!-- Welcome Modal -->
  <div class="modal-overlay" id="welcome-overlay"></div>
  <div class="modal" id="welcome-modal">
    <button class="modal-close" id="welcome-close">×</button>
    <h3 class="modal-title">Welcome to VelvetFlix!</h3>
    <div class="modal-content">
      <p>Unlock Your Secret Vibes with a Premium subscription for Ksh 99/month.</p>
      <ol>
        <li>Pay via M-Pesa (Till No: 123456).</li>
        <li>Send transaction code via WhatsApp to +254720047018.</li>
        <li>Redeem your access code to enjoy exclusive content!</li>
      </ol>
      <button class="profile-btn" style="width: 100%;" id="welcome-subscribe">Get Premium</button>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast"></div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="https://unpkg.com/lucide@0.441.0/dist/umd/lucide.min.js"></script>
  <script>
    lucide.createIcons();

    const { createElement, useState, useEffect } = React;
    const { createRoot } = ReactDOM;
    const SUPABASE_URL = 'https://dvicmtexrtfbxqomndxh.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR2aWNtdGV4cnRmYnhxb21uZHhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcwMDA0NzQsImV4cCI6MjA2MjU3NjQ3NH0.CqTnwcXARVLJsQkELi_xh2XaJ7ixMVjHk7ZZc5LhUrU';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    const ADMIN_EMAIL = 'your-admin-email@example.com';

    function App() {
      const [page, setPage] = useState('home');
      const [user, setUser] = useState(null);
      const [isPremium, setIsPremium] = useState(false);
      const [hasInteracted, setHasInteracted] = useState(false);
      const [ageVerified, setAgeVerified] = useState(localStorage.getItem('ageVerified') === 'true');

      useEffect(() => {
        setTimeout(() => document.getElementById('preloader').classList.add('hidden'), 500);
        document.addEventListener('click', () => setHasInteracted(true), { once: true });

        supabase.auth.getUser().then(({ data: { user } }) => {
          setUser(user);
          if (user?.email === ADMIN_EMAIL) setIsPremium(true);
          checkPremium(user?.id);
        });

        supabase.auth.onAuthStateChange((event, session) => {
          setUser(session?.user || null);
          if (session?.user?.email === ADMIN_EMAIL) setIsPremium(true);
          checkPremium(session?.user?.id);
        });

        if (!ageVerified) {
          document.getElementById('age-modal').classList.add('active');
          document.getElementById('age-overlay').classList.add('active');
        } else {
          document.getElementById('welcome-modal').classList.add('active');
          document.getElementById('welcome-overlay').classList.add('active');
        }

        // Expose setPage globally for menu links
        window.setPage = setPage;
      }, []);

      async function checkPremium(userId) {
        if (!userId) return;
        const { data, error } = await supabase
          .from('access_codes')
          .select('used')
          .eq('assigned_to', userId)
          .eq('used', true)
          .single();
        if (data && !error) setIsPremium(true);
      }

      function showToast(message, duration = 4000) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('active');
        setTimeout(() => toast.classList.remove('active'), duration);
      }

      function closeModals() {
        document.getElementById('welcome-modal').classList.remove('active');
        document.getElementById('welcome-overlay').classList.remove('active');
        document.getElementById('age-modal').classList.remove('active');
        document.getElementById('age-overlay').classList.remove('active');
      }

      async function handleLogout() {
        await supabase.auth.signOut();
        setUser(null);
        setIsPremium(false);
        setPage('auth');
        showToast('Logged out successfully');
      }

      return createElement(
        'div',
        { className: 'content' },
        createElement(HomePage, { active: page === 'home', user, isPremium, hasInteracted }),
        createElement(PremiumPage, { active: page === 'premium', user, isPremium, hasInteracted, setPage }),
        createElement(AuthPage, { active: page === 'auth', setUser, setPage }),
        createElement(ProfilePage, { active: page === 'profile', user, isPremium, handleLogout, setPage }),
        createElement(AdminPage, { active: page === 'admin', user, showToast }),
        createElement(PaywallPage, { active: page === 'paywall', user, setIsPremium, showToast, setPage }),
        createElement(ContactPage, { active: page === 'contact' }),
        createElement(PrivacyPage, { active: page === 'privacy' }),
        createElement(TermsPage, { active: page === 'terms' }),
        createElement(AboutPage, { active: page === 'about' }),
        createElement(NavBar, { page, setPage, user })
      );
    }

    function HomePage({ active, user, isPremium, hasInteracted }) {
      const [videos, setVideos] = useState([]);

      useEffect(() => {
        if (!active) return;
        async function loadVideos() {
          const { data: files, error } = await supabase.storage.from('previews').list('', { limit: 10 });
          if (error) {
            showToast(`Error loading videos: ${error.message}`);
            return;
          }
          const videoFiles = files.filter(file => /\.(mp4|webm)$/i.test(file.name));
          setVideos(videoFiles);
        }
        loadVideos();
      }, [active]);

      useEffect(() => {
        if (!active || !videos.length) return;
        const observer = new IntersectionObserver(
          entries => {
            entries.forEach(entry => {
              const video = entry.target.querySelector('video');
              if (entry.isIntersecting && hasInteracted) {
                gsap.fromTo(
                  entry.target,
                  { opacity: 0, scale: 0.95 },
                  { opacity: 1, scale: 1, duration: 0.24, ease: 'power2.out' }
                );
                video.play().catch(() => showToast('Tap to play video'));
              } else {
                video.pause();
                video.currentTime = 0;
              }
            });
          },
          { threshold: 0.9 }
        );

        document.querySelectorAll('.video-container').forEach(container => observer.observe(container));
        return () => observer.disconnect();
      }, [videos, active, hasInteracted]);

      return createElement(
        'section',
        { className: `page home-page ${active ? 'active' : ''}`, id: 'home-page' },
        createElement(
          'div',
          { className: 'video-feed' },
          videos.length
            ? videos.map(file =>
                createElement(VideoContainer, {
                  key: file.name,
                  file,
                  bucket: 'previews',
                  isPremium,
                  user
                })
              )
            : createElement(
                'p',
                { style: { textAlign: 'center', color: 'var(--text-secondary)' } },
                'No videos available'
              )
        )
      );
    }

    function PremiumPage({ active, user, isPremium, hasInteracted, setPage }) {
      const [videos, setVideos] = useState([]);

      useEffect(() => {
        if (!active) return;
        if (!user || !isPremium) {
          setVideos([]);
          return;
        }
        async function loadVideos() {
          const { data: files, error } = await supabase.storage.from('premuim').list('', { limit: 5 });
          if (error) {
            showToast(`Error loading premium videos: ${error.message}`);
            return;
          }
          const videoFiles = files.filter(file => /\.(mp4|webm)$/i.test(file.name));
          setVideos(videoFiles);
        }
        loadVideos();
      }, [active, user, isPremium]);

      useEffect(() => {
        if (!active || !videos.length) return;
        const observer = new IntersectionObserver(
          entries => {
            entries.forEach(entry => {
              const video = entry.target.querySelector('video');
              if (entry.isIntersecting && hasInteracted) {
                gsap.fromTo(
                  entry.target,
                  { opacity: 0, scale: 0.95 },
                  { opacity: 1, scale: 1, duration: 0.24, ease: 'power2.out' }
                );
                video.play().catch(() => showToast('Tap to play video'));
              } else {
                video.pause();
                video.currentTime = 0;
              }
            });
          },
          { threshold: 0.9 }
        );

        document.querySelectorAll('.video-container').forEach(container => observer.observe(container));
        return () => observer.disconnect();
      }, [videos, active, hasInteracted]);

      if (!user || !isPremium) {
        return createElement(
          'section',
          { className: `page premium-page ${active ? 'active' : ''}`, id: 'premium-page' },
          createElement(
            'div',
            { className: 'premium-locked' },
            createElement('h2', null, 'Unlock Premium Vibes'),
            createElement(
              'p',
              { style: { color: 'var(--text-secondary)', marginBottom: '1rem' } },
              'Sign in or redeem an access code to enjoy exclusive content.'
            ),
            createElement(
              'button',
              { onClick: () => setPage(user ? 'paywall' : 'auth') },
              user ? 'Redeem Code' : 'Sign In'
            )
          )
        );
      }

      return createElement(
        'section',
        { className: `page premium-page ${active ? 'active' : ''}`, id: 'premium-page' },
        createElement(
          'div',
          { className: 'video-feed' },
          videos.length
            ? videos.map(file =>
                createElement(VideoContainer, {
                  key: file.name,
                  file,
                  bucket: 'premuim',
                  isPremium,
                  user
                })
              )
            : createElement(
                'p',
                { style: { textAlign: 'center', color: 'var(--text-secondary)' } },
                'No premium videos available'
              )
        )
      );
    }

    function VideoContainer({ file, bucket, isPremium, user }) {
      const [videoUrl, setVideoUrl] = useState('');
      const [loaded, setLoaded] = useState(false);

      useEffect(() => {
        async function getVideoUrl() {
          const { data, error } = await supabase.storage.from(bucket).createSignedUrl(file.name, 3600);
          if (error) {
            console.warn(`Signed URL error for ${file.name}:`, error);
            setVideoUrl('https://www.w3schools.com/html/mov_bbb.mp4');
          } else {
            setVideoUrl(data.signedUrl);
          }
        }
        getVideoUrl();
      }, [file.name, bucket]);

      return createElement(
        'div',
        { className: `video-container ${loaded ? 'loaded' : ''}` },
        createElement('video', {
          muted: true,
          loop: true,
          playsInline: true,
          src: videoUrl,
          onLoadedData: () => setLoaded(true)
        }),
        !loaded && createElement('div', { className: 'video-loading' }),
        !isPremium && createElement('div', { className: 'watermark' }, `VelvetFlix${user?.id ? ` | ${user.id}` : ''}`),
        createElement(
          'div',
          { className: 'video-overlay' },
          createElement(
            'div',
            { className: 'video-info' },
            createElement('div', { className: 'video-title' }, file.name.replace(/\.[^/.]+$/, ''))
          ),
          createElement(
            'div',
            { className: 'video-actions' },
            createElement(
              'button',
              { className: 'action-btn', 'aria-label': 'Like video' },
              createElement('i', { 'data-lucide': 'heart' })
            )
          )
        )
      );
    }

    function AuthPage({ active, setUser, setPage }) {
      const [isSignUp, setIsSignUp] = useState(false);
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');

      async function handleSignIn() {
        if (!email || !password) {
          setError('Please enter email and password');
          return;
        }
        try {
          const { data, error } = await supabase.auth.signInWithPassword({ email, password });
          if (error) throw new Error(error.message);
          setUser(data.user);
          setPage('premium');
          showToast('Signed in successfully');
        } catch (err) {
          setError(err.message);
        }
      }

      async function handleSignUp() {
        if (!email || !password) {
          setError('Please enter email and password');
          return;
        }
        try {
          const { data, error } = await supabase.auth.signUp({ email, password });
          if (error) throw new Error(error.message);
          setUser(data.user);
          setPage('premium');
          showToast('Signed up successfully! Check your email for confirmation.');
          window.open('https://wa.me/254720047018', '_blank');
        } catch (err) {
          setError(err.message);
        }
      }

      return createElement(
        'section',
        { className: `page auth-page ${active ? 'active' : ''}`, id: 'auth-page' },
        createElement(
          'div',
          { className: 'auth-form' },
          createElement('h2', null, isSignUp ? 'Sign Up' : 'Sign In'),
          createElement('input', {
            type: 'email',
            placeholder: 'Email',
            value: email,
            onChange: e => setEmail(e.target.value),
            required: true,
            'aria-label': 'Email'
          }),
          createElement('input', {
            type: 'password',
            placeholder: 'Password',
            value: password,
            onChange: e => setPassword(e.target.value),
            required: true,
            'aria-label': 'Password'
          }),
          createElement('button', { onClick: isSignUp ? handleSignUp : handleSignIn }, isSignUp ? 'Sign Up' : 'Sign In'),
          createElement('p', { className: 'auth-error' }, error),
          createElement(
            'div',
            { className: 'auth-toggle' },
            isSignUp
              ? createElement('span', null, 'Already have an account? ', createElement('a', { onClick: () => setIsSignUp(false) }, 'Sign In'))
              : createElement('span', null, 'No account? ', createElement('a', { onClick: () => setIsSignUp(true) }, 'Sign Up'))
          )
        )
      );
    }

    function ProfilePage({ active, user, isPremium, handleLogout, setPage }) {
      const [theme, setTheme] = useState('dark');

      return createElement(
        'section',
        { className: `page profile-page ${active ? 'active' : ''}`, id: 'profile-page' },
        createElement(
          'div',
          { className: 'profile-header' },
          createElement('div', { className: 'profile-avatar' }),
          createElement(
            'div',
            { className: 'profile-info' },
            createElement('div', { className: 'profile-email' }, user?.email || 'Guest'),
            createElement(
              'div',
              { className: 'profile-status' },
              isPremium ? 'Premium' : 'Free'
            )
          )
        ),
        createElement(
          'div',
          { className: 'profile-actions' },
          !isPremium &&
            createElement(
              'button',
              { className: 'profile-btn', onClick: () => setPage('paywall') },
              'Upgrade to Premium'
            ),
          user &&
            createElement(
              'button',
              { className: 'profile-btn', onClick: handleLogout },
              'Logout'
            ),
          createElement(
            'button',
            {
              className: 'profile-btn',
              onClick: () => {
                setTheme(theme === 'dark' ? 'light' : 'dark');
                document.body.style.background = theme === 'dark' ? '#D1D5DB' : '#343541';
              }
            },
            `Switch to ${theme === 'dark' ? 'Light' : 'Dark'} Theme`
          )
        )
      );
    }

    function AdminPage({ active, user, showToast }) {
      const [file, setFile] = useState(null);
      const [title, setTitle] = useState('');
      const [bucket, setBucket] = useState('previews');
      const [error, setError] = useState('');

      async function handleUpload() {
        if (!user || user.email !== ADMIN_EMAIL) {
          setError('Unauthorized: Admin access only');
          return;
        }
        if (!file || !title) {
          setError('Please select a file and enter a title');
          return;
        }
        if (!/\.(mp4|webm)$/i.test(file.name)) {
          setError('Only .mp4 or .webm files allowed');
          return;
        }
        try {
          const fileName = `${Date.now()}_${title.replace(/\s+/g, '_')}.${file.name.split('.').pop()}`;
          const { error: uploadError } = await supabase.storage.from(bucket).upload(fileName, file);
          if (uploadError) throw new Error(`Upload failed: ${uploadError.message}`);
          setFile(null);
          setTitle('');
          setError('');
          showToast('Video uploaded successfully');
        } catch (err) {
          setError(err.message);
        }
      }

      if (!user || user.email !== ADMIN_EMAIL) return null;

      return createElement(
        'section',
        { className: `page admin-page ${active ? 'active' : ''}`, id: 'admin-page' },
        createElement(
          'div',
          { className: 'admin-form' },
          createElement('h2', null, 'Upload Video'),
          createElement('input', {
            type: 'file',
            accept: 'video/mp4,video/webm',
            onChange: e => setFile(e.target.files[0]),
            required: true,
            'aria-label': 'Video file'
          }),
          createElement('input', {
            type: 'text',
            placeholder: 'Video Title',
            value: title,
            onChange: e => setTitle(e.target.value),
            required: true,
            'aria-label': 'Video title'
          }),
          createElement(
            'select',
            {
              value: bucket,
              onChange: e => setBucket(e.target.value),
              'aria-label': 'Video category'
            },
            createElement('option', { value: 'previews' }, 'Previews'),
            createElement('option', { value: 'premuim' }, 'Premium')
          ),
          createElement('button', { onClick: handleUpload }, 'Upload'),
          createElement('p', { className: 'auth-error' }, error)
        )
      );
    }

    function PaywallPage({ active, user, setIsPremium, showToast, setPage }) {
      const [code, setCode] = useState('');
      const [error, setError] = useState('');

      async function handleRedeem() {
        if (!user) {
          setError('Please sign in to redeem a code');
          return;
        }
        if (!code) {
          setError('Please enter an access code');
          return;
        }
        try {
          const { data, error } = await supabase
            .from('access_codes')
            .select('*')
            .eq('code', code)
            .eq('used', false)
            .single();
          if (error || !data) throw new Error('Invalid or used code');
          await supabase
            .from('access_codes')
            .update({ used: true, assigned_to: user.id })
            .eq('code', code);
          setIsPremium(true);
          setPage('premium');
          showToast('Premium unlocked!');
        } catch (err) {
          setError(err.message);
        }
      }

      return createElement(
        'section',
        { className: `page paywall-page ${active ? 'active' : ''}`, id: 'paywall-page' },
        createElement(
          'div',
          { className: 'paywall-form' },
          createElement('h2', null, 'Unlock Premium'),
          createElement('input', {
            type: 'text',
            placeholder: 'Enter Access Code',
            value: code,
            onChange: e => setCode(e.target.value),
            required: true,
            'aria-label': 'Access code'
          }),
          createElement('button', { onClick: handleRedeem }, 'Redeem'),
          createElement('p', { className: 'auth-error' }, error)
        )
      );
    }

    function ContactPage({ active }) {
      return createElement(
        'section',
        { className: `page static-page ${active ? 'active' : ''}`, id: 'contact-page' },
        createElement('h2', null, 'Contact Us'),
        createElement('p', null, 'Have questions or feedback? Reach out to us!'),
        createElement('p', null, 'Email: ', createElement('a', { href: 'mailto:support@velvetflix.com' }, 'support@velvetflix.com')),
        createElement('p', null, 'WhatsApp: ', createElement('a', { href: 'https://wa.me/254720047018' }, '+254 720 047018'))
      );
    }

    function PrivacyPage({ active }) {
      return createElement(
        'section',
        { className: `page static-page ${active ? 'active' : ''}`, id: 'privacy-page' },
        createElement('h2', null, 'Privacy Policy'),
        createElement('p', null, 'At VelvetFlix, we value your privacy. This policy outlines how we collect, use, and protect your personal information.'),
        createElement('p', null, 'We collect email addresses for authentication and communication purposes. Your data is stored securely with Supabase and not shared with third parties.'),
        createElement('p', null, 'For more details, contact us at ', createElement('a', { href: 'mailto:support@velvetflix.com' }, 'support@velvetflix.com'), '.')
      );
    }

    function TermsPage({ active }) {
      return createElement(
        'section',
        { className: `page static-page ${active ? 'active' : ''}`, id: 'terms-page' },
        createElement('h2', null, 'Terms of Service'),
        createElement('p', null, 'By using VelvetFlix, you agree to our terms of service. You must be 18+ to access our content.'),
        createElement('p', null, 'Premium subscriptions require payment via M-Pesa and a valid access code. Refunds are not available.'),
        createElement('p', null, 'Contact us at ', createElement('a', { href: 'mailto:support@velvetflix.com' }, 'support@velvetflix.com'), ' for support.')
      );
    }

    function AboutPage({ active }) {
      return createElement(
        'section',
        { className: `page static-page ${active ? 'active' : ''}`, id: 'about-page' },
        createElement('h2', null, 'About VelvetFlix'),
        createElement('p', null, 'VelvetFlix is your destination for exclusive, premium video content. Unlock your secret vibes with our curated selection.'),
        createElement('p', null, 'Founded in 2025, we aim to provide a seamless and secure experience for our users.'),
        createElement('p', null, 'Join us today at ', createElement('a', { href: 'https://wa.me/254720047018' }, '+254 720 047018'), '.')
      );
    }

    function NavBar({ page, setPage, user }) {
      return createElement(
        'nav',
        null,
        createElement(
          'button',
          {
            className: `nav-btn ${page === 'home' ? 'active' : ''}`,
            onClick: () => setPage('home'),
            'aria-label': 'Home'
          },
          createElement('i', { 'data-lucide': 'home' }),
          'Home'
        ),
        createElement(
          'button',
          {
            className: `nav-btn ${page === 'premium' ? 'active' : ''}`,
            onClick: () => setPage('premium'),
            'aria-label': 'Premium'
          },
          createElement('i', { 'data-lucide': 'star' }),
          'Premium'
        ),
        createElement(
          'button',
          {
            className: `nav-btn ${page === 'profile' ? 'active' : ''}`,
            onClick: () => setPage('profile'),
            'aria-label': 'Profile'
          },
          createElement('i', { 'data-lucide': 'user' }),
          'Profile'
        ),
        user?.email === ADMIN_EMAIL &&
          createElement(
            'button',
            {
              className: `nav-btn ${page === 'admin' ? 'active' : ''}`,
              onClick: () => setPage('admin'),
              'aria-label': 'Admin'
            },
            createElement('i', { 'data-lucide': 'upload' }),
            'Admin'
          )
      );
    }

    const root = createRoot(document.getElementById('app'));
    root.render(createElement(App));

    document.getElementById('age-confirm').addEventListener('click', () => {
      localStorage.setItem('ageVerified', 'true');
      document.getElementById('age-modal').className = 'modal';
      document.getElementById('age-overlay').className = 'modal-overlay';
      document.getElementById('welcome-modal').className = 'modal active';
      document.getElementById('welcome-overlay').className = 'modal-overlay active';
    });

    document.getElementById('welcome-close').addEventListener('click', () => {
      document.getElementById('welcome-modal').className = 'modal';
      document.getElementById('welcome-overlay').className = 'modal-overlay';
    });

    document.getElementById('welcome-subscribe').addEventListener('click', () => {
      window.open('https://wa.me/254720047018', '_blank');
    });

    document.getElementById('welcome-overlay').addEventListener('click', e => {
      if (e.target === document.getElementById('welcome-overlay')) {
        document.getElementById('welcome-modal').className = 'modal';
        document.getElementById('welcome-overlay').className = 'modal-overlay';
      }
    });

    document.getElementById('menu-btn').addEventListener('click', () => {
      document.getElementById('menu').classList.add('active');
    });

    document.getElementById('menu-close').addEventListener('click', () => {
      document.getElementById('menu').classList.remove('active');
    });
  </script>
</body>
</html>